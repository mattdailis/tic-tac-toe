(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(t,e,n){},15:function(t,e,n){},16:function(t,e,n){"use strict";n.r(e);var o=n(0),i=n.n(o),s=n(7),a=n.n(s),l=(n(14),n(15),n(1)),h=n(2),c=n(4),r=n(3),u=n(5),y=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(c.a)(this,Object(r.a)(e).call(this,t))).updateAnimationState=function(){n.setState(function(t){return{n:t.n}}),n.setState({rAF:requestAnimationFrame(n.updateAnimationState)})},n.click=function(t){var e=!0;n.state.moves.length>0&&"x"==n.state.moves[n.state.moves.length-1].player&&(e=!1);var o={player:e?"x":"o",x:Math.floor(t.x+.5),y:Math.floor(t.y+.5),type:"logical"},i=!0,s=!1,a=void 0;try{for(var l,h=n.state.moves[Symbol.iterator]();!(i=(l=h.next()).done);i=!0){var c=l.value;if(Math.floor(c.x+.5)==Math.floor(o.x+.5)&&Math.floor(c.y+.5)==Math.floor(o.y+.5))return}}catch(u){s=!0,a=u}finally{try{i||null==h.return||h.return()}finally{if(s)throw a}}n.setState({moves:n.state.moves.concat([o])});var r={player:o.player,x:o.x,y:o.y};n.state.ws.send(JSON.stringify(r))},n.moveCenter=function(t){n.setState({center:{x:n.state.center.x+t.x,y:n.state.center.y+t.y,type:"logical"}})},console.log(window.location),n.state={n:5,rAF:null,center:{x:0,y:0,type:"logical"},scale:1,moves:[{player:"x",x:0,y:0,type:"logical"}],ws:new WebSocket("ws://"+window.location.host+"/ws")},n}return Object(u.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){var t=this,e=this.state.ws;e.onopen=function(){console.log("connected")},e.onmessage=function(e){var n=JSON.parse(e.data),o=(n.game_id,n.moves);t.setState({moves:o})},e.onclose=function(){console.log("disconnected"),t.setState({ws:new WebSocket("ws://"+window.location.host+"/ws")})}}},{key:"componentWillUnmount",value:function(){null!==this.state.rAF&&cancelAnimationFrame(this.state.rAF)}},{key:"render",value:function(){return i.a.createElement(v,{scale:this.state.scale,center:this.state.center,moveCenter:this.moveCenter,moves:this.state.moves,click:this.click})}}]),e}(i.a.Component),v=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(c.a)(this,Object(r.a)(e).call(this,t))).state={canvasRef:i.a.createRef(),mouseDown:!1,mouseMoved:!1,delta:50,previousTouch:null,initialOffset:{x:window.innerWidth/2,y:window.innerHeight/2,type:"physical"}},n}return Object(u.a)(e,t),Object(h.a)(e,[{key:"handleMouseDown",value:function(){this.setState({mouseDown:!0,mouseMoved:!1})}},{key:"handleMouseMove",value:function(t){this.setState({mouseMoved:!0}),this.state.mouseDown&&this.props.moveCenter({x:t.movementX/this.state.delta,y:t.movementY/this.state.delta,type:"logical"})}},{key:"handleMouseUp",value:function(t){this.setState({mouseDown:!1})}},{key:"handleDoubleClick",value:function(t){this.props.click(this.phys_to_log({x:t.clientX,y:t.clientY,type:"physical"}))}},{key:"handleTouchMove",value:function(t){if(this.setState({mouseMoved:!0}),t.preventDefault(),null!=this.state.previousTouch){var e=t.touches[0].clientX-this.state.previousTouch.x,n=t.touches[0].clientY-this.state.previousTouch.y;this.setState({previousTouch:{x:t.touches[0].clientX,y:t.touches[0].clientY,type:"physical"}}),this.props.moveCenter({x:1*e/this.state.delta,y:1*n/this.state.delta,type:"logical"})}else this.setState({previousTouch:{x:t.touches[0].clientX,y:t.touches[0].clientY,type:"physical"}})}},{key:"handleTouchStart",value:function(t){this.setState({previousTouch:{x:t.touches[0].clientX,y:t.touches[0].clientY,type:"physical"}})}},{key:"handleTouchEnd",value:function(t){this.setState({previousTouch:null}),this.state.mouseMoved||null==this.state.previousTouch||this.props.click(this.phys_to_log({x:this.state.previousTouch.x,y:this.state.previousTouch.y,type:"physical"}))}},{key:"handleWheel",value:function(t){t.deltaY>0?this.setState({delta:this.state.delta+1}):t.deltaY<0&&this.state.delta>20&&this.setState({delta:this.state.delta-1})}},{key:"render",value:function(){return i.a.createElement("canvas",{ref:this.state.canvasRef,onMouseDown:this.handleMouseDown.bind(this),onMouseMove:this.handleMouseMove.bind(this),onMouseUp:this.handleMouseUp.bind(this),onTouchStart:this.handleTouchStart.bind(this),onTouchMove:this.handleTouchMove.bind(this),onTouchEnd:this.handleTouchEnd.bind(this),onDoubleClick:this.handleDoubleClick.bind(this),onWheel:this.handleWheel.bind(this)})}},{key:"componentDidMount",value:function(){this.draw()}},{key:"componentDidUpdate",value:function(){this.draw()}},{key:"draw",value:function(){var t=this.state.canvasRef.current;if(null!=t){t.width=window.innerWidth,t.height=window.innerHeight;var e=t.getContext("2d");if(null!=e){for(var n=this.props.center,o=this.state.delta/this.props.scale,i=(n.x%1-.5)*o+this.state.initialOffset.x%o;i<t.width;i+=o)e.beginPath(),e.moveTo(i,0),e.lineTo(i,t.height),e.stroke();for(var s=(n.y%1-.5)*o+this.state.initialOffset.y%o;s<t.height;s+=o)e.beginPath(),e.moveTo(0,s),e.lineTo(t.width,s),e.stroke();if(this.props.moves.length>0){var a=this.log_to_phys(this.props.moves[this.props.moves.length-1]),l=a.x,h=a.y;e.fillStyle="#00FFFF",e.fillRect(1+l-o/2,1+h-o/2,o-2,o-2)}var c=!0,r=!1,u=void 0;try{for(var y,v=this.props.moves[Symbol.iterator]();!(c=(y=v.next()).done);c=!0){var p=y.value;if(this.nearScreen(p)){var d=this.log_to_phys(p),f=d.x,m=d.y,w=20*o/75;"x"==p.player?(e.beginPath(),e.moveTo(f-w,m-w),e.lineTo(f+w,m+w),e.moveTo(f+w,m-w),e.lineTo(f-w,m+w),e.stroke()):"o"==p.player&&(e.beginPath(),e.arc(f,m,.3*o,0,2*Math.PI),e.stroke())}}}catch(x){r=!0,u=x}finally{try{c||null==v.return||v.return()}finally{if(r)throw u}}}}}},{key:"log_to_phys",value:function(t){var e=this.props.center,n=this.state,o=n.delta,i=n.initialOffset;return null==this.state.canvasRef.current?{x:0,y:0,type:"physical"}:{x:(e.x+t.x)*o+i.x,y:(e.y+t.y)*o+i.y,type:"physical"}}},{key:"phys_to_log",value:function(t){var e=this.props.center,n=this.state,o=n.delta,i=n.initialOffset;return null==this.state.canvasRef.current?{x:0,y:0,type:"logical"}:{x:(t.x-i.x)/o-e.x,y:(t.y-i.y)/o-e.y,type:"logical"}}},{key:"nearScreen",value:function(t){var e={x:t.x-.5,y:t.y-.5,type:"logical"},n={x:t.x+.5,y:t.y-.5,type:"logical"},o={x:t.x-.5,y:t.y+.5,type:"logical"},i={x:t.x+.5,y:t.y+.5,type:"logical"};return this.onScreen(e)||this.onScreen(n)||this.onScreen(o)||this.onScreen(i)}},{key:"onScreen",value:function(t){var e=this.log_to_phys(t),n=e.x,o=e.y,i=this.state.canvasRef.current;return null!=i&&(n>=0&&n<=i.width&&o>=0&&o<=i.height)}}]),e}(i.a.Component),p=y,d=function(){return i.a.createElement(p,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(i.a.createElement(d,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},8:function(t,e,n){t.exports=n(16)}},[[8,1,2]]]);
//# sourceMappingURL=main.55d7a785.chunk.js.map